{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/blog/clone-vm-proxmox/","result":{"data":{"markdownRemark":{"html":"<p>I generally store one VM for my most popular operating systems as a spun down clone on my Proxmox host. This makes it super simple for me to spin up a fresh VM in case I want to try something new, or if i need to isolate and troubleshoot a problem I've been having on a different guest.</p>\n<p>For this quick tutorial I'll be cloning a version of Ubuntu that I already has stored as a clone on my host machine.</p>\n<p>There are a few different things that I always like to do immediately after cloning a VM.</p>\n<ul>\n<li>Change the options for the VM</li>\n<li>Change the hostname</li>\n<li>Change the IP address</li>\n<li>Expand the disk</li>\n</ul>\n<h2>Change VM Options</h2>\n<p>The first thing we have to do is actually clone the VM and decide on a few options.</p>\n<p>From the stored VM clone click the 'More' option at the top right of the summary screen, then select 'Clone'.</p>\n<p>Follow the prompt to select options and continue. I usually clone each VM as a full clone, rather than linking them. To be honest, I'm not too sure what a 'Linked Clone' is, or how it would be useful.</p>\n<p>After this is done choose what hardware options you'd like your machine to have. In the sidebar on the right select the 'Hardware' option. Select how much RAM you'd like to allocate, and increase the disk size if you'd like. Note that you can only increase the disk size and not decrease it, plus this will take a bit more work to accomplish.</p>\n<p>Now that we've got all of our options configured go ahead and start the machine, then head to the 'Console' tab to begin updating our info.</p>\n<h2>Change Hostname:</h2>\n<p>The first thing that we'll change is the hostname for the machine.</p>\n<p>After you login to your shell you, you can display the current hostname, by entering this command:</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">hostnamectl</code>\n        </deckgo-highlight-code>\n<p>The info about the machine will be displayed:<img src=\"https://billyjacoby.com/content/images/2020/05/hostnamectl.png\" alt=\"\"></p>\n<p>As of Ubuntu 18.04 we can change the hostname using the same command with some flags.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">sudo hostnamectl set-hostname newHostName</code>\n        </deckgo-highlight-code>\n<p>Running the <code>hostnamectl</code> command again after this will show us our new host name.<img src=\"https://billyjacoby.com/content/images/2020/05/new-hostnamectl.png\" alt=\"\"></p>\n<p>After this we still need to edit the hosts file. This is located at <code>/etc/hosts</code>.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">sudo vim /etc/hosts</code>\n        </deckgo-highlight-code>\n<p>Remove the old hostname, and replace it with your new desired one.<img src=\"https://billyjacoby.com/content/images/2020/05/hosts-file.png\" alt=\"\"></p>\n<p>Next we need to edit the cloud.cfg file if it exists. This is a file that belong to the cloud-init package which makes managing cloud instances of images simpler.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">sudo vim /etc/cloud-init/cloud.cfg</code>\n        </deckgo-highlight-code>\n<p>Here we will find the line that says <code>preserver_hostname</code> and change it from <code>false</code> to <code>true</code>.</p>\n<h2>Change IP Address:</h2>\n<p>Please make sure that you are connected to your VM via the console in the Proxmox Web GUI, otherwise you will lose the connection to the VM.</p>\n<p>I always statically assign my VMs their IP address in order to avoid any conflict. I also have a range of IPs on my LAN that I use to make this easier as well.</p>\n<p>This makes it easier to know how to access the VM when I am first configuring it. If you don't have a specific range of IPs dedicated to your VMs I would certainly recommend making this IP static on the router itself after initial setup though.</p>\n<p>For now we will change the IP using netplan.</p>\n<p>Your mileage my vary, but I can always find my netplan configs here:</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">sudo vim /etc/netplan/50-cloud-init.yaml</code>\n        </deckgo-highlight-code>\n<p>All we've got to do is edit this file to reflect the changes that we'd like to see.<img src=\"https://billyjacoby.com/content/images/2020/05/netplan.png\" alt=\"\"></p>\n<p>Then edit the address from whatever it is (192.168.1.20 in my case) to what you'd like it to be.</p>\n<p>Then generate and apply the config</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">sudo netplan generate\nsudo netplan apply</code>\n        </deckgo-highlight-code>\n<p>Now running <code>ifconfig</code> will show you the new IP address you've assigned!</p>\n<h2>Expand the Disk</h2>\n<p>Now the last step is to expand the hard disk to use all available space. This is a more lengthy process, and as such I will cover it in another blog post. This can be found <a href=\"https://billyjacoby.com/how-to-expand-the-disk-on-a-ubuntu-vm/\">here.</a></p>\n<p>Feel free to enter your email address below to get notified when new posts come out. Thanks for reading!</p>","frontmatter":{"date":"May 27, 2020","slug":"/blog/clone-vm-proxmox","title":"How to clone a VM in Proxmox"}}},"pageContext":{"id":"d78f89c0-54c9-5ecd-be48-fdb7d5532bdd","frontmatter__slug":"/blog/clone-vm-proxmox","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":[]}