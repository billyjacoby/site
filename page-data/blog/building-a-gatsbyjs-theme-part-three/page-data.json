{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/blog/building-a-gatsbyjs-theme-part-three/","result":{"data":{"markdownRemark":{"html":"<h2>Making our existing theme composable</h2>\n<p>This is part three in a multi-part tutorial series on building your own Gatsby theme from scratch.</p>\n<p>Please checkout the <a href=\"https://billyjacoby.dev/intro-to-gatsby-themes\">Introduction</a>, <a href=\"https://billyjacoby.dev/building-a-gatsbyjs-theme-part-one\">Part One</a>, and <a href=\"https://billyjacoby.dev/building-a-gatsbyjs-theme-part-two\">Part Two</a> of this series if you haven't yet, as we will be picking up right where we left off at the end of part Two.</p>\n<p>The finished code for this portion of the tutorial can be found on my github repo <a href=\"https://github.com/billyjacoby/gabsty-theme-tutorial/tree/part-three\">here.</a></p>\n<p>The end goal of this tutorial is to break down some common website functions into their own respective themes in order to allow us to use them as <em>basically</em> their own components. That means that we need to make sure that each component plays nicely with each other. We'll have to change a few things in our theme to do this.</p>\n<p>Here's what we'll be tackling in this part of the tutorial:</p>\n<ul>\n<li>Change existing theme name</li>\n<li>Update our project's dependencies</li>\n<li>Add the ability to take options into our theme</li>\n<li>Pass options in to our theme</li>\n<li>Export components from our theme to be used in our site</li>\n</ul>\n<h3>Change existing theme name</h3>\n<p>The theme we have been working on this far we have named <code>gatsby-theme-tutorial</code>. the first thing that we'll do here is change this name to reflect the goal of this theme. We'll change this directory name to <code>gatsby-theme-style</code> for now. After doing this our folder structure will look like this:</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">gatsby-theme-tutorial-development/\n--packages/\n  |--gatsby-theme-style/\n    |--package.json\n    ...\n--site/\n  |--package.json\n--package.json</code>\n        </deckgo-highlight-code>\n<p>We'll also need to update our <code>packages/gatsby-theme-style/package.json</code> and <code>site/package.json</code> file to change the name of our theme from <code>gatsby-theme-tutorial</code> to <code>gatsby-theme-style</code>.</p>\n<p>We're also going to move the <code>index.js</code> file from our theme's pages folder into our site's pages folder.</p>\n<p>Before we can continue with this build and run our development site again, we have to do a few other things.</p>\n<h3>Update our dependencies</h3>\n<p>Next, we will need to update out gatsby-config.js in our site directory, but before we do this lets go ahead and update all of our packages by running <code>yarn upgrade</code> in our root project directory.</p>\n<p>We're doing this mainly because it's been a while since we've done any work on this tutorial and we want to be sure we're using the most up to date packages.</p>\n<p>After everything has been updated, lets import our theme as a plugin rather than using the <code>__experimental</code> tag that we've been using.</p>\n<h4>site/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">module.exports = {\n  siteMetadata: {\n    title: `New Gatsby Site`,\n    description: `A website using our Gatsby theme!`,\n  },\n  plugins: [\n    {\n      resolve: &quot;gatsby-theme-style&quot;,\n      options: {\n        // blank for now, but we;ll be coming back to this\n      },\n    },\n  ],\n}</code>\n        </deckgo-highlight-code>\n<p>Now if we run <code>yarn workspace site develop</code> you should see that our site works the exact same way that it did at the end of our last tutorial. Now about that empty options objectâ€¦</p>\n<h3>Passing options into our theme</h3>\n<p>We can pass any number of options to our theme using the options object from the <code>gatsby-config.js</code> of our site. This can be anything from color schemes, to navigation items, and much more. We're going to start by passing an option that tells our theme if we would like our <code>Layout</code> component to continue to wrap the root element - what it's currently doing.</p>\n<h4>site/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">module.exports = {\n  siteMetadata: {\n    title: `New Gatsby Site`,\n    description: `A website using our Gatsby theme!`,\n  },\n  plugins: [\n    {\n      resolve: &quot;gatsby-theme-style&quot;,\n      options: {\n        wrapRootElement: false,\n      },\n    },\n  ],\n}</code>\n        </deckgo-highlight-code>\n<p>Now in order to be able to access this options object in our theme we must make a change to our theme's <code>gatbsy-config.js</code></p>\n<h4>packages/gatsby-theme-style/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">module.exports = themeOptions =&gt; ({\n  siteMetadata: {\n    title: `Gatsby Theme Tutorial`,\n    description: `A tutorial for building a GatsbyJS theme from scratch!`,\n  },\n  plugins: [\n    {\n      resolve: `gatsby-plugin-page-creator`,\n      options: {\n        path: `${__dirname}/src/pages`,\n      },\n    },\n  ],\n})</code>\n        </deckgo-highlight-code>\n<p>This will enable us to access the <code>themeOptions</code> object just about anywhere in our theme to make decisions based on the options passed in. Now lets utilize this object in both our <code>packages/gatsby-theme-style/gatsby-browser.js</code> and <code>packages/gatsby-theme-style/gatsby-ssr.js</code> files to determine whether or not we should wrap our root element in our theme's styles or not.</p>\n<h4>packages/gatsby-theme-style/gatsby-browser.js</h4>\n<p>AND</p>\n<h4>packages/gatsby-theme-style/gatsby-ssr.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">import React from &quot;react&quot;\nimport Layout from &quot;./src/components/layout&quot;\n\nexport const wrapPageElement = ({ element, props }, themeOptions) =&gt; {\n  // props provide same data to Layout as Page element will get\n  // including location, data, etc - you don&#39;t need to pass it\n  if (themeOptions.wrapRootElement) {\n    return &lt;Layout {...props}&gt;{element}&lt;/Layout&gt;\n  } else {\n    return\n  }\n}</code>\n        </deckgo-highlight-code>\n<p>After we make this change we see that our website no longer has any styles applied! Now if we toggle the <code>wrapRootElement</code> option to true in our <code>site/gatsby-config.js</code> file, we'll see all of our styles get applied again.</p>\n<p><strong><em>Note that you may have to stop and restart your development server for this to take effect</em></strong></p>\n<p>Before we do anything else lets add a quick navbar component to our theme so that we can change between pages.</p>\n<h4>packages/gatsby-theme-style/src/components/navbar.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">import React from &quot;react&quot;\nimport { Link } from &quot;gatsby&quot;\n\nimport &quot;../styles/navbar.css&quot;\n\nconst Navbar = () =&gt; {\n  return (\n    &lt;nav&gt;\n      &lt;ul&gt;\n        &lt;li&gt;\n          &lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;\n        &lt;/li&gt;\n      &lt;/ul&gt;\n    &lt;/nav&gt;\n  )\n}\n\nexport default Navbar</code>\n        </deckgo-highlight-code>\n<h4>packages/gatsby-theme-style/src/style/navbar.css</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">ul {\n  list-style-type: none;\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n  background-color: #333;\n}\n\nli {\n  float: left;\n}\n\nli a {\n  display: block;\n  color: white;\n  text-align: center;\n  padding: 14px 16px;\n  text-decoration: none;\n}\n\nli a:hover {\n  background-color: #111;\n}</code>\n        </deckgo-highlight-code>\n<p>Then lets make a few changes to our <code>Header.css</code> and add the component to our header as well.</p>\n<h4>packages/gatsby-theme-style/src/style/header.css</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">.header {\n  margin: -8px;\n  // CHANGED\n  padding: 1.5rem 0 0 0;\n  // DELETED WIDTH PROPERTY\n  align-self: center;\n  text-align: center;\n  background-color: purple;\n  font-family: Arial, Helvetica, sans-serif;\n  border-bottom: solid black;\n}\n...</code>\n        </deckgo-highlight-code>\n<h4>packages/gatsby-theme-style/src/components/header.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">import React from &quot;react&quot;\nimport { useStaticQuery, graphql, Link } from &quot;gatsby&quot;\nimport Navbar from &quot;./navbar&quot;\n\nimport &quot;../styles/header.css&quot;\n\nconst Header = () =&gt; {\n  const data = useStaticQuery(graphql`\n    query {\n      site {\n        siteMetadata {\n          title\n          description\n        }\n      }\n    }\n  `)\n\n  return (\n    &lt;div className=&quot;header&quot;&gt;\n      &lt;Link to=&quot;/&quot; className=&quot;no-style&quot;&gt;\n        &lt;h1 className=&quot;site-heading&quot;&gt;{data.site.siteMetadata.title}&lt;/h1&gt;\n        &lt;h4&gt;{data.site.siteMetadata.description}&lt;/h4&gt;\n      &lt;/Link&gt;\n      &lt;Navbar /&gt;\n    &lt;/div&gt;\n  )\n}\n\nexport default Header</code>\n        </deckgo-highlight-code>\n<p>Now when we go to our home page we see the navbar with a link to the home page. This is where things can get a little more complicated.</p>\n<p>We have more than just the home page in our site's pages directory, but how do we tell our theme to add those to the navbar? One way to do this is to update the options object with all of our page info.</p>\n<h3>Pass options in to our theme</h3>\n<p>Lets add a <code>navigationPages</code> object to our options object that will be passed in to our theme.</p>\n<h4>site/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">...\n  plugins: [\n    {\n      resolve: &quot;gatsby-theme-style&quot;,\n      options: {\n        wrapRootElement: true,\n        // NEW OBJECT\n        navigationPages: [\n          {\n            name: &quot;About&quot;,\n            title: &quot;About Us Page&quot;,\n            path: &quot;/about&quot;\n          }\n        ]\n      }\n    }\n  ]\n...</code>\n        </deckgo-highlight-code>\n<p>Now in our theme, lets make this object accessible to our siteMetadata object.</p>\n<h4>packages/gatsby-theme-style/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">module.exports = themeOptions =&gt; ({\n  siteMetadata: {\n    title: `Gatsby Theme Tutorial`,\n    description: `A tutorial for building a GatsbyJS theme from scratch!`,\n    // NEW\n    navigationPages: themeOptions.navigationPages\n      ? [...themeOptions.navigationPages]\n      : &quot;null&quot;,\n  },\n  plugins: [\n    {\n      resolve: `gatsby-plugin-page-creator`,\n      options: {\n        path: `${__dirname}/src/pages`,\n      },\n    },\n  ],\n})</code>\n        </deckgo-highlight-code>\n<p>I'm not sure if there is a better way, but in order to allow the graphql query to fail silently we need to use a ternary operator here in order to check if this option was passed into our theme. This way if a user does not pass additional pages in to our theme package we can still query the rest of the siteMetadata without getting an error from graphql.</p>\n<p>Lets update the static query in our header component, and then pass that data down to our navbar component.</p>\n<h4>packages/gatsby-theme-style/src/components/header.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">...\n  const data = useStaticQuery(graphql`\n    query {\n      site {\n        siteMetadata {\n          title\n          description\n          navigationPages {\n            name\n            title\n            path\n          }\n        }\n      }\n    }\n  `);\n\n  return (\n    &lt;div className=&quot;header&quot;&gt;\n      &lt;Link to=&quot;/&quot; className=&quot;no-style&quot;&gt;\n        &lt;h1 className=&quot;site-heading&quot;&gt;{data.site.siteMetadata.title}&lt;/h1&gt;\n        &lt;h4&gt;{data.site.siteMetadata.description}&lt;/h4&gt;\n      &lt;/Link&gt;\n      &lt;Navbar navigationPages={data.site.siteMetadata.navigationPages} /&gt;\n    &lt;/div&gt;\n  );\n};\n...</code>\n        </deckgo-highlight-code>\n<p>And finally lets access this new data in our navbar component and add the page to our navbar!</p>\n<h4>packages/gatsby-theme-style/components/navbar.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">...\n    &lt;nav&gt;\n      &lt;ul&gt;\n        &lt;li&gt;\n          &lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;\n        &lt;/li&gt;\n        {navigationPages.map((item, index) =&gt; (\n          &lt;li key={index}&gt;\n            &lt;Link to={item.path}&gt;{item.name}&lt;/Link&gt;\n          &lt;/li&gt;\n        ))}\n      &lt;/ul&gt;\n    &lt;/nav&gt;\n...</code>\n        </deckgo-highlight-code>\n<p>Now we can navigate between all of the pages in our site's directory from our theme's navbar component!</p>\n<p>This all works great if we want every page of our site to be styled by our theme, but what if we don't? How would we use the theme's style only on specific pages?</p>\n<h3>Export components from our theme to be used in our site</h3>\n<p>In order to choose to use specific components from our theme, we need to export those components from our theme package. This is done simply from inside our package's <code>index.js</code> file.</p>\n<p>Currently the only line of code in this file is a comment that reads <code>//no-op</code>. All we have to do to allow our site to import components from our theme is add some export statements to this file.</p>\n<h4>packages/gatsby-theme-style/index.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">export { default as Layout } from &quot;./src/components/layout&quot;\nexport { default as Header } from &quot;./src/components/header&quot;\nexport { default as Navbar } from &quot;./src/components/navbar&quot;</code>\n        </deckgo-highlight-code>\n<p>Now lets change the wrapRootElement option in out <code>site/gatsby-config.js</code> file to false so that we can selectively choose which page will be styled with out Layout component.</p>\n<h4>site/gatsby-config.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">...\n      wrapRootElement: false,\n...</code>\n        </deckgo-highlight-code>\n<p>After restarting our development server we will see that our theme's styles are no longer applied to any of our site's pages. Lets manually apply them to our index page.</p>\n<h4>site/src/pages/index.js</h4>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"synthwave\"  >\n          <code slot=\"code\">import React from &quot;react&quot;\nimport { Layout } from &quot;gatsby-theme-style&quot;\n\nexport default () =&gt; (\n  &lt;Layout&gt;\n    &lt;h1&gt;Hello World!&lt;/h1&gt;\n  &lt;/Layout&gt;\n)</code>\n        </deckgo-highlight-code>\n<p>Just like that all of the components from our theme are now importable and able to be used by any site that is using them!</p>\n<h3>Wrapping Up</h3>\n<p>So in this part of the tutorial we changed and updated some things on our existing theme to enable our theme to play nicely with other themes that might be composed together to make up a website.</p>\n<p>One of the things that makes Gatsby themes so appealing is the ability to compose multiple themes together. Breaking down website functionality into separate themes will allow us, as developers, to simply require a gatsby theme to add all of the functionality of a blog, or a store, or just about anything you can think of.</p>\n<p>I'm already using a lot of these features on a regular basis, and I can say for certain that it has drastically improved my development workflow.</p>\n<p>Thanks for reading!</p>","frontmatter":{"date":"November 21, 2019","slug":"/blog/building-a-gatsbyjs-theme-part-three","title":"Building a GatsbyJS Theme - Part Three"}}},"pageContext":{"id":"63abb3de-183e-5a08-96c8-cff5bdd92f21","frontmatter__slug":"/blog/building-a-gatsbyjs-theme-part-three","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":[]}